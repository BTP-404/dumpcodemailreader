sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/PDFViewer","sap/ui/core/Fragment"],function(e,t,i,a,o){"use strict";return e.extend("com.mailprocessor.controller.InvoiceApp",{onInit:function(){var e=this.byId("mailTable11");var t=e.getBinding("items");if(t){var i=new sap.ui.model.Filter({path:"subject",operator:sap.ui.model.FilterOperator.EQ,value1:"invoice"});t.filter([i])}else{e.attachEventOnce("updateFinished",function(){t=e.getBinding("items");if(t){var i=new sap.ui.model.Filter({path:"subject",operator:sap.ui.model.FilterOperator.EQ,value1:"invoice"});t.filter([i])}})}},onShowAttachments:function(e){var a=e.getSource().getParent();var o=a.getBindingContext();var n=o.getProperty("ID");if(!this._oAttachmentDialog){this._oAttachmentDialog=sap.ui.xmlfragment(this.getView().getId(),"com.mailprocessor.fragments.AttachmentDialog",this);this.getView().addDependent(this._oAttachmentDialog)}this._fetchAttachments(n).then(function(e){var i=new t({attachments:e});this._oAttachmentDialog.setModel(i);this._oAttachmentDialog.open()}.bind(this)).catch(function(e){i.show("Error fetching attachments.");console.error("Error fetching attachments:",e)})},_fetchAttachments:function(e){var t=this.getView().getModel();return t.bindList(`/EmailData(${e})/attachments`).requestContexts().then(function(e){return e.map(function(e){return e.getObject()})})},onDialogOpen:function(){this.getView().byId("deleteButton").setEnabled(false)},onUploadPress:function(){this.getView().byId("deleteButton").setEnabled(true);console.log("File uploaded")},onDeletePress:function(){console.log("Delete button pressed")},onDownloadPress:function(){var e=this.getView().byId("attachmentTable1");var t=e.getSelectedItem();if(t){var i=t.getBindingContext();var a=i.getProperty("file");if(a){var o=document.createElement("a");o.href="data:application/octet-stream;base64,"+a;o.download=i.getProperty("fileName");o.click();console.log("File downloaded")}}else{sap.m.MessageToast.show("Please select a file to download")}},onSearch1:function(e){var t=e.getParameter("newValue");var i=this.getView().byId("attachmentTable1");var a=i.getBinding("items");var o=[];if(t){o.push(new sap.ui.model.Filter("fileName",sap.ui.model.FilterOperator.Contains,t))}a.filter(o)},onFilterPress:function(){console.log("Filter button pressed")},onSortPress:function(){var e=this.getView().byId("attachmentTable1");var t=e.getBinding("items");var i=[];i.push(new sap.ui.model.Sorter("fileName",false));t.sort(i);console.log("Sort button pressed")},onPreviewAttachment:function(e){var t=e.getSource().getBindingContext();var n=t.getProperty("fileType");var c=t.getProperty("file");if(!this._oPreviewDialog){this._oPreviewDialog=sap.ui.xmlfragment(this.getView().getId(),"com.mailprocessor.fragments.Attachment",this);this.getView().addDependent(this._oPreviewDialog)}var h=o.byId(this.getView().getId(),"filePreview");if(n==="application/pdf"){var s=atob(c);var r=new Array(s.length);for(var l=0;l<s.length;l++){r[l]=s.charCodeAt(l)}var d=new Uint8Array(r);var m=new Blob([d],{type:"application/pdf"});var W=URL.createObjectURL(m);if(!this._pdfViewer){this._pdfViewer=new a({title:"PDF Preview",showDownloadButton:false,width:"auto",height:"600px"});this.getView().addDependent(this._pdfViewer)}this._pdfViewer.setSource(W);this._pdfViewer.open();this._pdfViewer.attachAfterClose(function(){URL.revokeObjectURL(W)})}else if(n.startsWith("image/")){var I="<img src='data:"+n+";base64,"+c+"' style='max-width: 100%; max-height: 400px;' />";h.setContent(I)}else if(n==="text/plain"){var u=atob(c);h.setContent("<pre>"+u+"</pre>")}else{i.show("Unsupported file type for preview.")}this._oPreviewDialog.open()},onProceedWithOcr:function(e){var t=this;try{console.log("Proceed with OCR triggered");var a=e.getSource().getBindingContext();if(!a){console.error("No binding context found");return}var o=a.getProperty("fileType");var n=a.getProperty("file");if(!o||!n){console.error("File type or file content missing");return}var c=atob(n);var h=new Array(c.length);for(var s=0;s<c.length;s++){h[s]=c.charCodeAt(s)}var r=new Uint8Array(h);var l=new Blob([r],{type:o});var d=new FormData;d.append("file",l,"document.pdf");console.log("testing Himanshu ===========");console.log("testing Himanshu ===========");fetch("https://aiservices-trial-dox.cfapps.us10.hana.ondemand.com/document-information-extraction/v1/clients?limit=6",{method:"GET",headers:{Authorization:"Bearer eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vN2QzYjBmZjN0cmlhbC5hdXRoZW50aWNhdGlvbi51czEwLmhhbmEub25kZW1hbmQuY29tL3Rva2VuX2tleXMiLCJraWQiOiJkZWZhdWx0LWp3dC1rZXktMTEwZDY5MTdlMCIsInR5cCI6IkpXVCIsImppZCI6ICJUM0RoMisvZzBXYkp4WnVkNG9veTR6YnVvWkwvSW1jSi9FblhRcWVZajdBPSJ9.eyJqdGkiOiI5YzAwM2EwNDViZjU0OGNmYjlhNTgyNmE1OGMwNmE5ZSIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiI4MzY1ZTY4NS02N2M3LTQxMDYtODY2Mi02ZmNmNzRjMGM2MDAiLCJ6ZG4iOiI3ZDNiMGZmM3RyaWFsIiwic2VydmljZWluc3RhbmNlaWQiOiJjMTI4ZWZiOC01ZWEwLTQ4MDQtYWFjMy05NWQ4MGIxNjUzOWQifSwic3ViIjoic2ItYzEyOGVmYjgtNWVhMC00ODA0LWFhYzMtOTVkODBiMTY1MzlkIWIzMzc1NjN8ZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQiLCJhdXRob3JpdGllcyI6WyJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5zY2hlbWEud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5pZGVudGlmaWVyLnJlYWQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5kb2N1bWVudC53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LnRlbXBsYXRlLnJlYWQiLCJ1YWEucmVzb3VyY2UiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5ydWxlcy53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LnRlbXBsYXRlLndyaXRlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuZGF0YS1leHBvcnQucmVhZCIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmNsaWVudC5yZWFkIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuZG9jdW1lbnQucmVhZCIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmRhdGEtZXhwb3J0LndyaXRlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuZGF0YS53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmlkZW50aWZpZXIud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50cmFpbmluZy1kYXRhLndyaXRlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuc2NoZW1hLnJlYWQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50ZWNobmljYWxzY29wZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmNsaWVudC53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmNvbmZpZy5yZWFkIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuY2FwYWJpbGl0aWVzLnJlYWQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5kYXRhLnJlYWQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5jb25maWcud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50cmFpbmluZy1kYXRhLnJlYWQiXSwic2NvcGUiOlsiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuc2NoZW1hLndyaXRlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuaWRlbnRpZmllci5yZWFkIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuZG9jdW1lbnQud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50ZW1wbGF0ZS5yZWFkIiwidWFhLnJlc291cmNlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQucnVsZXMud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50ZW1wbGF0ZS53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmRhdGEtZXhwb3J0LnJlYWQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5jbGllbnQucmVhZCIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmRvY3VtZW50LnJlYWQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5kYXRhLWV4cG9ydC53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmRhdGEud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5pZGVudGlmaWVyLndyaXRlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQudHJhaW5pbmctZGF0YS53cml0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LnNjaGVtYS5yZWFkIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQudGVjaG5pY2Fsc2NvcGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5jbGllbnQud3JpdGUiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5jb25maWcucmVhZCIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmNhcGFiaWxpdGllcy5yZWFkIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuZGF0YS5yZWFkIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuY29uZmlnLndyaXRlIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQudHJhaW5pbmctZGF0YS5yZWFkIl0sImNsaWVudF9pZCI6InNiLWMxMjhlZmI4LTVlYTAtNDgwNC1hYWMzLTk1ZDgwYjE2NTM5ZCFiMzM3NTYzfGRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0IiwiY2lkIjoic2ItYzEyOGVmYjgtNWVhMC00ODA0LWFhYzMtOTVkODBiMTY1MzlkIWIzMzc1NjN8ZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQiLCJhenAiOiJzYi1jMTI4ZWZiOC01ZWEwLTQ4MDQtYWFjMy05NWQ4MGIxNjUzOWQhYjMzNzU2M3xkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NCIsImdyYW50X3R5cGUiOiJjbGllbnRfY3JlZGVudGlhbHMiLCJyZXZfc2lnIjoiYThkMDg4YWIiLCJpYXQiOjE3Mjc1MzM1MDgsImV4cCI6MTcyNzU3NjcwOCwiaXNzIjoiaHR0cHM6Ly83ZDNiMGZmM3RyaWFsLmF1dGhlbnRpY2F0aW9uLnVzMTAuaGFuYS5vbmRlbWFuZC5jb20vb2F1dGgvdG9rZW4iLCJ6aWQiOiI4MzY1ZTY4NS02N2M3LTQxMDYtODY2Mi02ZmNmNzRjMGM2MDAiLCJhdWQiOlsiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuc2NoZW1hIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuY2FwYWJpbGl0aWVzIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuZG9jdW1lbnQiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50ZW1wbGF0ZSIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmRhdGEiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC50cmFpbmluZy1kYXRhIiwidWFhIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQiLCJzYi1jMTI4ZWZiOC01ZWEwLTQ4MDQtYWFjMy05NWQ4MGIxNjUzOWQhYjMzNzU2M3xkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NCIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmNsaWVudCIsImRveC14c3VhYS1zdGQtdHJpYWwhYjEwODQ0LmRhdGEtZXhwb3J0IiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQucnVsZXMiLCJkb3gteHN1YWEtc3RkLXRyaWFsIWIxMDg0NC5pZGVudGlmaWVyIiwiZG94LXhzdWFhLXN0ZC10cmlhbCFiMTA4NDQuY29uZmlnIl19.bmhZC0th_pbQRgks9Wf2Ung8wWMjTxTmtNlBH5clJC_SBS13WRcJcQzEc3H0RMM187-Ll3LLaFmGSQ4mTk0-UZu72o5HoFty02S7z2C0cdG6DmOdfOsa8jJHMVG6_PSN-SWg3c1sRJByIpeclXVAlmRAgK13H_7ez1lEmTXOS4c2_S8oe8qV2sV7-aximaP_fDojuA38GYuT3hylcyF86jVxv9AYw8AAmFkAaYi3gE7LI4cqBuQPMw6YcYd_mYXvd_rQXBGpm_ODWoayG7TO5ntsX-5bIpmooUP9LgTf-NQwEcooYPioBO_YVcINgY7B6-6Ab-u70Hr0p5Q0xa9vkw"}}).then(e=>{if(!e.ok){throw new Error("Failed to fetch data. Status: "+e.status)}return e.json()}).then(e=>{console.log("Data retrieved successfully:",e)}).catch(e=>{console.error("Error during data fetch:",e);i.show("Error fetching data.")});fetch("https://mysubaccount-axm16i2j.it-cpitrial05-rt.cfapps.us10-001.hana.ondemand.com/http/OCR?query=cheque",{method:"POST",headers:{Authorization:"Basic "+btoa("sb-d5ebeff3-ce5d-4b20-bca1-e3e84befc3ea!b331941|it-rt-mysubaccount-axm16i2j!b26655:0f5f92f0-f77b-47b8-ab6c-d6e6f3f04df0$ZRa7HjGkdgeIoI8owOHMViLNx-G2BEHrVPVr7vVfyxc=")}}).then(e=>{if(!e.ok){throw new Error("Failed to submit document. Status: "+e.status)}return e.json()}).then(e=>{if(e&&e.id){console.log("OCR processing submitted successfully. Job ID:",e.id);i.show("Document submitted successfully! Job ID: "+e.id)}else{console.error("No job ID returned. Response:",e);i.show("Document submitted but no job ID returned.")}}).catch(e=>{console.error("Error during OCR submission:",e);i.show("Error during document submission.")})}catch(e){console.error("OCR process failed:",e);i.show("An error occurred while processing the document.")}}})});
//# sourceMappingURL=InvoiceApp.controller.js.map